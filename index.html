<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BeLive ALPS Management Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f6fa;
            height: 100vh;
            overflow: hidden;
        }

        .dashboard {
            display: flex;
            height: 100vh;
        }

        .sidebar {
            width: 280px;
            background: #2c3e50;
            color: white;
            padding: 20px;
            overflow-y: auto;
        }

        .nav-item {
            padding: 15px;
            margin: 5px 0;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .nav-item:hover, .nav-item.active {
            background: #34495e;
            transform: translateX(5px);
        }

        .nav-icon {
            font-size: 20px;
        }

        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .header {
            background: white;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .content-area {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        /* Agent Status Page */
        .agents-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .agent-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            cursor: pointer;
            border-left: 5px solid #3498db;
        }

        .agent-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .agent-card.top-sales {
            border-left-color: #f39c12;
            background: linear-gradient(135deg, #fff9e6 0%, #ffffff 100%);
        }

        .agent-card.available {
            border-left-color: #2ecc71;
        }

        .agent-card.busy {
            border-left-color: #e74c3c;
        }

        .agent-card.away {
            border-left-color: #95a5a6;
        }

        .agent-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .agent-name {
            font-size: 18px;
            font-weight: bold;
        }

        .agent-status {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }

        .status-available { background: #2ecc71; color: white; }
        .status-busy { background: #e74c3c; color: white; }
        .status-away { background: #f39c12; color: white; }

        .capacity-bar {
            background: #ecf0f1;
            height: 12px;
            border-radius: 6px;
            overflow: hidden;
            margin: 10px 0;
        }

        .capacity-fill {
            height: 100%;
            transition: width 0.5s ease;
            border-radius: 6px;
        }

        .capacity-low { background: #2ecc71; }
        .capacity-medium { background: #f39c12; }
        .capacity-high { background: #e74c3c; }

        .agent-stats {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #2c3e50;
        }

        .stat-label {
            font-size: 12px;
            color: #7f8c8d;
        }

        .queue-management {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .queue-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            margin: 10px 0;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #3498db;
        }

        .drag-handle {
            cursor: grab;
            color: #7f8c8d;
            font-size: 18px;
        }

        .drag-handle:active {
            cursor: grabbing;
        }

        /* Lead Page */
        .leads-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            height: 100%;
        }

        .leads-section {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #ecf0f1;
        }

        .leads-list {
            flex: 1;
            overflow-y: auto;
        }

        .lead-item {
            display: flex;
            align-items: center;
            padding: 15px;
            margin: 10px 0;
            background: #f8f9fa;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-left: 4px solid #95a5a6;
        }

        .lead-item:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .lead-item.hot {
            border-left-color: #e74c3c;
            background: linear-gradient(135deg, #ffebee 0%, #f8f9fa 100%);
        }

        .lead-item.warm {
            border-left-color: #f39c12;
            background: linear-gradient(135deg, #fff8e1 0%, #f8f9fa 100%);
        }

        .lead-item.cold {
            border-left-color: #95a5a6;
        }

        .lead-score {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            margin-right: 15px;
            font-size: 18px;
        }

        .score-hot { background: linear-gradient(135deg, #e74c3c, #c0392b); }
        .score-warm { background: linear-gradient(135deg, #f39c12, #e67e22); }
        .score-cold { background: linear-gradient(135deg, #95a5a6, #7f8c8d); }

        .lead-info {
            flex: 1;
        }

        .lead-name {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .lead-details {
            font-size: 14px;
            color: #7f8c8d;
        }

        .lead-timestamp {
            font-size: 12px;
            color: #bdc3c7;
        }

        /* Chart Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            width: 80%;
            max-width: 800px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: #000;
        }

        /* Chat Window Page */
        .chat-container {
            background: white;
            border-radius: 15px;
            height: 100%;
            display: flex;
            flex-direction: column;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .chat-header {
            background: #25D366;
            color: white;
            padding: 20px;
            border-radius: 15px 15px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background: linear-gradient(to bottom, #e5ddd5 0%, #e5ddd5 100%);
        }

        .message {
            max-width: 70%;
            margin-bottom: 15px;
            padding: 12px 16px;
            border-radius: 18px;
            position: relative;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message-bot {
            background: white;
            align-self: flex-start;
            border-bottom-left-radius: 4px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }

        .message-user {
            background: #DCF8C6;
            align-self: flex-end;
            margin-left: auto;
            border-bottom-right-radius: 4px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }

        /* SLA Page */
        .sla-container {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
            height: 100%;
        }

        .conversations-list {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            overflow-y: auto;
        }

        .conversation-item {
            padding: 15px;
            margin: 10px 0;
            background: #f8f9fa;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-left: 4px solid #3498db;
        }

        .conversation-item:hover {
            background: #e3f2fd;
            transform: translateX(5px);
        }

        .conversation-item.sla-warning {
            border-left-color: #f39c12;
            background: #fff8e1;
        }

        .conversation-item.sla-breach {
            border-left-color: #e74c3c;
            background: #ffebee;
        }

        .sla-timer {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }

        .timer-negative {
            background: #e74c3c;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-weight: bold;
        }

        .timer-positive {
            background: #f39c12;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-weight: bold;
        }

        .sla-chat-area {
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
        }

        .sla-chat-header {
            background: #34495e;
            color: white;
            padding: 20px;
            border-radius: 15px 15px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .sla-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background: #f8f9fa;
        }

        .sla-input {
            padding: 20px;
            border-top: 1px solid #ecf0f1;
            display: flex;
            gap: 10px;
        }

        .sla-input input {
            flex: 1;
            padding: 12px;
            border: 2px solid #ecf0f1;
            border-radius: 25px;
            outline: none;
        }

        .sla-input button {
            padding: 12px 20px;
            background: #25D366;
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
        }

        /* SLA Alert */
        .sla-alert {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            z-index: 1000;
            display: none;
            text-align: center;
            border-left: 5px solid #e74c3c;
        }

        .alert-actions {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            justify-content: center;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: #3498db;
            color: white;
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        /* Real-time indicators */
        .live-indicator {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            background: #e74c3c;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
        }

        .pulse-dot {
            width: 8px;
            height: 8px;
            background: white;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        /* Options styling for chat */
        .options-container {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 10px;
        }

        .option-button {
            padding: 10px 15px;
            background: #f0f0f0;
            border: 2px solid #e0e0e0;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
        }

        .option-button:hover {
            background: #25D366;
            color: white;
            border-color: #25D366;
        }

        .property-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .property-item {
            padding: 12px;
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
        }

        .property-item:hover {
            background: #25D366;
            color: white;
            border-color: #25D366;
        }

        .score-bar {
            width: 100%;
            height: 20px;
            background: rgba(255,255,255,0.3);
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }

        .score-fill {
            height: 100%;
            transition: width 0.5s ease;
            border-radius: 10px;
        }

        .input-field {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 20px;
            margin-top: 10px;
            font-size: 16px;
        }

        .typing-indicator {
            display: none;
            background: white;
            padding: 15px;
            border-radius: 18px;
            margin-bottom: 15px;
            max-width: 70%;
            border-bottom-left-radius: 4px;
        }

        .typing-dots {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background: #999;
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }

        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-10px); }
        }

        .checkbox-group {
            margin-top: 10px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            margin: 8px 0;
            padding: 8px;
            background: #f8f9fa;
            border-radius: 8px;
            cursor: pointer;
            border: 2px solid #e9ecef;
            transition: all 0.2s ease;
        }

        .checkbox-item:hover {
            background: #e3f2fd;
            border-color: #3498db;
        }

        .checkbox-item input[type="checkbox"] {
            margin-right: 10px;
            transform: scale(1.2);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                width: 250px;
            }
            
            .agents-grid {
                grid-template-columns: 1fr;
            }
            
            .leads-container {
                grid-template-columns: 1fr;
            }
            
            .sla-container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <!-- Sidebar Navigation -->
        <div class="sidebar">
            <h2 style="margin-bottom: 30px;">🏠 BeLive ALPS</h2>
            
            <div class="nav-item active" data-page="agents">
                <span class="nav-icon">👥</span>
                <span>Agent Status</span>
            </div>
            
            <div class="nav-item" data-page="leads">
                <span class="nav-icon">📊</span>
                <span>Lead Management</span>
            </div>
            
            <div class="nav-item" data-page="chat">
                <span class="nav-icon">💬</span>
                <span>Chat Window</span>
            </div>
            
            <div class="nav-item" data-page="sla">
                <span class="nav-icon">⏱️</span>
                <span>SLA Monitoring</span>
            </div>

            <div style="margin-top: 50px; padding: 20px; background: rgba(255,255,255,0.1); border-radius: 10px;">
                <div class="live-indicator">
                    <div class="pulse-dot"></div>
                    LIVE
                </div>
                <div style="margin-top: 10px; font-size: 14px;">
                    System Status: Active<br>
                    Last Update: <span id="lastUpdate">--:--:--</span>
                </div>
            </div>
        </div>

        <!-- Main Content Area -->
        <div class="main-content">
            <div class="header">
                <div>
                    <h1 id="pageTitle">Agent Status Dashboard</h1>
                    <p id="pageSubtitle">Real-time monitoring and management</p>
                </div>
                <div class="live-indicator">
                    <div class="pulse-dot"></div>
                    LIVE DASHBOARD
                </div>
            </div>

            <div class="content-area">
                <!-- Agent Status Page -->
                <div id="agents" class="page active">
                    <div class="agents-grid">
                        <div class="agent-card top-sales available" data-agent="agent1" onclick="goToAgentConversations('agent1')">
                            <div class="agent-header">
                                <div class="agent-name">👑 Sarah Chen</div>
                                <div class="agent-status status-available">Available</div>
                            </div>
                            <div>Top Sales Agent • Queue Position: 1</div>
                            <div class="capacity-bar">
                                <div class="capacity-fill capacity-low" style="width: 30%"></div>
                            </div>
                            <div>Capacity: 3/10 chats</div>
                            <div class="agent-stats">
                                <div class="stat-item">
                                    <div class="stat-number">95%</div>
                                    <div class="stat-label">SLA Rate</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-number">8.7</div>
                                    <div class="stat-label">Avg Score</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-number">24</div>
                                    <div class="stat-label">Leads Today</div>
                                </div>
                            </div>
                        </div>

                        <div class="agent-card busy" data-agent="agent2" onclick="goToAgentConversations('agent2')">
                            <div class="agent-header">
                                <div class="agent-name">Mike Johnson</div>
                                <div class="agent-status status-busy">Busy</div>
                            </div>
                            <div>Senior Agent • Queue Position: 2</div>
                            <div class="capacity-bar">
                                <div class="capacity-fill capacity-high" style="width: 80%"></div>
                            </div>
                            <div>Capacity: 8/10 chats</div>
                            <div class="agent-stats">
                                <div class="stat-item">
                                    <div class="stat-number">88%</div>
                                    <div class="stat-label">SLA Rate</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-number">7.9</div>
                                    <div class="stat-label">Avg Score</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-number">18</div>
                                    <div class="stat-label">Leads Today</div>
                                </div>
                            </div>
                        </div>

                        <div class="agent-card available" data-agent="agent3" onclick="goToAgentConversations('agent3')">
                            <div class="agent-header">
                                <div class="agent-name">Lisa Wong</div>
                                <div class="agent-status status-available">Available</div>
                            </div>
                            <div>Agent • Queue Position: 3</div>
                            <div class="capacity-bar">
                                <div class="capacity-fill capacity-medium" style="width: 50%"></div>
                            </div>
                            <div>Capacity: 5/10 chats</div>
                            <div class="agent-stats">
                                <div class="stat-item">
                                    <div class="stat-number">92%</div>
                                    <div class="stat-label">SLA Rate</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-number">8.2</div>
                                    <div class="stat-label">Avg Score</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-number">15</div>
                                    <div class="stat-label">Leads Today</div>
                                </div>
                            </div>
                        </div>

                        <div class="agent-card away" data-agent="agent4" onclick="goToAgentConversations('agent4')">
                            <div class="agent-header">
                                <div class="agent-name">David Lim</div>
                                <div class="agent-status status-away">Break</div>
                            </div>
                            <div>Agent • Queue Position: 4</div>
                            <div class="capacity-bar">
                                <div class="capacity-fill capacity-low" style="width: 0%"></div>
                            </div>
                            <div>Capacity: 0/10 chats</div>
                            <div class="agent-stats">
                                <div class="stat-item">
                                    <div class="stat-number">85%</div>
                                    <div class="stat-label">SLA Rate</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-number">7.4</div>
                                    <div class="stat-label">Avg Score</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-number">12</div>
                                    <div class="stat-label">Leads Today</div>
                                </div>
                            </div>
                        </div>

                        <div class="agent-card available" data-agent="agent5" onclick="goToAgentConversations('agent5')">
                            <div class="agent-header">
                                <div class="agent-name">Jennifer Tan</div>
                                <div class="agent-status status-available">Available</div>
                            </div>
                            <div>Junior Agent • Queue Position: 5</div>
                            <div class="capacity-bar">
                                <div class="capacity-fill capacity-low" style="width: 20%"></div>
                            </div>
                            <div>Capacity: 2/10 chats</div>
                            <div class="agent-stats">
                                <div class="stat-item">
                                    <div class="stat-number">78%</div>
                                    <div class="stat-label">SLA Rate</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-number">6.8</div>
                                    <div class="stat-label">Avg Score</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-number">9</div>
                                    <div class="stat-label">Leads Today</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="queue-management">
                        <h3 style="margin-bottom: 20px;">📋 Agent Queue Management</h3>
                        <p style="margin-bottom: 15px; color: #7f8c8d;">Drag agents to reorder priority queue</p>
                        
                        <div id="queueList">
                            <div class="queue-item" draggable="true" data-agent="agent1">
                                <div style="display: flex; align-items: center; gap: 15px;">
                                    <div class="drag-handle">≡</div>
                                    <div>👑 <strong>Sarah Chen</strong> - Top Sales</div>
                                </div>
                                <div>Position: 1</div>
                            </div>
                            
                            <div class="queue-item" draggable="true" data-agent="agent2">
                                <div style="display: flex; align-items: center; gap: 15px;">
                                    <div class="drag-handle">≡</div>
                                    <div><strong>Mike Johnson</strong> - Senior Agent</div>
                                </div>
                                <div>Position: 2</div>
                            </div>
                            
                            <div class="queue-item" draggable="true" data-agent="agent3">
                                <div style="display: flex; align-items: center; gap: 15px;">
                                    <div class="drag-handle">≡</div>
                                    <div><strong>Lisa Wong</strong> - Agent</div>
                                </div>
                                <div>Position: 3</div>
                            </div>
                            
                            <div class="queue-item" draggable="true" data-agent="agent4">
                                <div style="display: flex; align-items: center; gap: 15px;">
                                    <div class="drag-handle">≡</div>
                                    <div><strong>David Lim</strong> - Agent</div>
                                </div>
                                <div>Position: 4</div>
                            </div>
                            
                            <div class="queue-item" draggable="true" data-agent="agent5">
                                <div style="display: flex; align-items: center; gap: 15px;">
                                    <div class="drag-handle">≡</div>
                                    <div><strong>Jennifer Tan</strong> - Junior Agent</div>
                                </div>
                                <div>Position: 5</div>
                            </div>
                        </div>
                        
                        <div style="margin-top: 20px; padding: 15px; background: #e8f5e8; border-radius: 10px;">
                            <strong>💡 Management Controls:</strong>
                            <button class="btn btn-primary" onclick="promoteToTopSales()" style="margin: 10px 5px;">Promote Selected to Top Sales</button>
                            <button class="btn btn-danger" onclick="removeFromQueue()" style="margin: 10px 5px;">Remove from Queue</button>
                        </div>
                    </div>
                </div>

                <!-- Lead Management Page -->
                <div id="leads" class="page">
                    <div class="leads-container">
                        <div class="leads-section">
                            <div class="section-header">
                                <h3>🔥 Ongoing Leads</h3>
                                <div class="live-indicator">
                                    <div class="pulse-dot"></div>
                                    LIVE
                                </div>
                            </div>
                            <div class="leads-list" id="ongoingLeads">
                                <div class="lead-item hot" data-lead="lead1" onclick="showLeadChart('lead1')">
                                    <div class="lead-score score-hot">87</div>
                                    <div class="lead-info">
                                        <div class="lead-name">🔥 Lead #2024001</div>
                                        <div class="lead-details">
                                            Area: Mont Kiara • Budget: RM1200<br>
                                            Move-in: 3 days • Agent: Sarah Chen
                                        </div>
                                        <div class="lead-timestamp">Started: 14:32 • Duration: 12 mins</div>
                                    </div>
                                </div>

                                <div class="lead-item hot" data-lead="lead2" onclick="showLeadChart('lead2')">
                                    <div class="lead-score score-hot">82</div>
                                    <div class="lead-info">
                                        <div class="lead-name">🔥 Lead #2024002</div>
                                        <div class="lead-details">
                                            Area: KL/Selangor • Budget: RM900<br>
                                            Move-in: 1 week • Agent: Mike Johnson
                                        </div>
                                        <div class="lead-timestamp">Started: 14:45 • Duration: 8 mins</div>
                                    </div>
                                </div>

                                <div class="lead-item warm" data-lead="lead3" onclick="showLeadChart('lead3')">
                                    <div class="lead-score score-warm">65</div>
                                    <div class="lead-info">
                                        <div class="lead-name">⭐ Lead #2024003</div>
                                        <div class="lead-details">
                                            Area: Petaling Jaya • Budget: RM750<br>
                                            Move-in: 2 weeks • Agent: Lisa Wong
                                        </div>
                                        <div class="lead-timestamp">Started: 14:52 • Duration: 5 mins</div>
                                    </div>
                                </div>

                                <div class="lead-item warm" data-lead="lead4" onclick="showLeadChart('lead4')">
                                    <div class="lead-score score-warm">58</div>
                                    <div class="lead-info">
                                        <div class="lead-name">⭐ Lead #2024004</div>
                                        <div class="lead-details">
                                            Area: JB/Penang • Budget: RM600<br>
                                            Move-in: 1 month • Agent: In Queue
                                        </div>
                                        <div class="lead-timestamp">Started: 15:01 • Duration: 2 mins</div>
                                    </div>
                                </div>

                                <div class="lead-item cold" data-lead="lead5" onclick="showLeadChart('lead5')">
                                    <div class="lead-score score-cold">32</div>
                                    <div class="lead-info">
                                        <div class="lead-name">❄️ Lead #2024005</div>
                                        <div class="lead-details">
                                            Area: Genting • Budget: RM400<br>
                                            Move-in: 3 months • Agent: AI Bot
                                        </div>
                                        <div class="lead-timestamp">Started: 15:03 • Duration: 4 mins</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="leads-section">
                            <div class="section-header">
                                <h3>📋 Past Leads</h3>
                                <div style="font-size: 14px; color: #7f8c8d;">Last 24 hours</div>
                            </div>
                            <div class="leads-list" id="pastLeads">
                                <div class="lead-item hot" data-lead="past1" onclick="showLeadChart('past1')">
                                    <div class="lead-score score-hot">91</div>
                                    <div class="lead-info">
                                        <div class="lead-name">✅ Lead #2024-100</div>
                                        <div class="lead-details">
                                            Converted • Final Score: 91<br>
                                            Agent: Sarah Chen • Duration: 25 mins
                                        </div>
                                        <div class="lead-timestamp">Completed: 13:45</div>
                                    </div>
                                </div>

                                <div class="lead-item warm" data-lead="past2" onclick="showLeadChart('past2')">
                                    <div class="lead-score score-warm">67</div>
                                    <div class="lead-info">
                                        <div class="lead-name">📞 Lead #2024-099</div>
                                        <div class="lead-details">
                                            Callback Scheduled • Final Score: 67<br>
                                            Agent: Mike Johnson • Duration: 18 mins
                                        </div>
                                        <div class="lead-timestamp">Completed: 12:30</div>
                                    </div>
                                </div>

                                <div class="lead-item cold" data-lead="past3" onclick="showLeadChart('past3')">
                                    <div class="lead-score score-cold">28</div>
                                    <div class="lead-info">
                                        <div class="lead-name">❌ Lead #2024-098</div>
                                        <div class="lead-details">
                                            No Interest • Final Score: 28<br>
                                            Agent: AI Bot • Duration: 8 mins
                                        </div>
                                        <div class="lead-timestamp">Completed: 11:15</div>
                                    </div>
                                </div>

                                <div class="lead-item hot" data-lead="past4" onclick="showLeadChart('past4')">
                                    <div class="lead-score score-hot">85</div>
                                    <div class="lead-info">
                                        <div class="lead-name">🏠 Lead #2024-097</div>
                                        <div class="lead-details">
                                            Viewing Scheduled • Final Score: 85<br>
                                            Agent: Lisa Wong • Duration: 22 mins
                                        </div>
                                        <div class="lead-timestamp">Completed: 10:45</div>
                                    </div>
                                </div>

                                <div class="lead-item warm" data-lead="past5" onclick="showLeadChart('past5')">
                                    <div class="lead-score score-warm">54</div>
                                    <div class="lead-info">
                                        <div class="lead-name">📧 Lead #2024-096</div>
                                        <div class="lead-details">
                                            Email Captured • Final Score: 54<br>
                                            Agent: AI Bot • Duration: 12 mins
                                        </div>
                                        <div class="lead-timestamp">Completed: 09:20</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Chat Window Page -->
                <div id="chat" class="page">
                    <div class="chat-container">
                        <div class="chat-header">
                            <div>
                                <h3>🤖 BeLive AI Assistant</h3>
                                <div>Lead Qualification Chat • No Timer (AI Handling)</div>
                            </div>
                            <div style="background: rgba(255,255,255,0.2); padding: 15px; border-radius: 12px; min-width: 200px;">
                                <h4 style="color: white; margin-bottom: 10px;">ALPS Score</h4>
                                <div class="score-bar">
                                    <div class="score-fill score-cold" id="chatScoreBar" style="width: 0%; background: rgba(255,255,255,0.8);"></div>
                                </div>
                                <div id="chatScoreText" style="color: white; font-weight: bold; margin-top: 5px;">0 / 100</div>
                                <div id="chatScoreCategory" style="color: white; font-size: 14px;">Getting Started</div>
                            </div>
                        </div>

                        <div class="chat-messages" id="chatMessages">
                            <div class="typing-indicator" id="typingIndicator">
                                <div class="typing-dots">
                                    <div class="typing-dot"></div>
                                    <div class="typing-dot"></div>
                                    <div class="typing-dot"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SLA Monitoring Page -->
                <div id="sla" class="page">
                    <div class="sla-container">
                        <div class="conversations-list">
                            <h3 style="margin-bottom: 20px;">💬 Active Conversations</h3>
                            <div style="margin-bottom: 15px; font-size: 14px; color: #7f8c8d;">
                                Click on any conversation to manage
                            </div>

                            <div class="conversation-item" onclick="openSLAChat('conv1')">
                                <div style="display: flex; justify-content: space-between; align-items: start;">
                                    <div>
                                        <div><strong>Lead #2024001</strong> • Sarah Chen</div>
                                        <div style="font-size: 14px; color: #7f8c8d;">Mont Kiara • ALPS: 87</div>
                                    </div>
                                    <div style="text-align: right;">
                                        <div style="font-size: 12px; color: #2ecc71;">✅ Active</div>
                                    </div>
                                </div>
                                <div class="sla-timer">
                                    <div class="timer-negative">-7:23</div>
                                    <div style="font-size: 12px;">Next response due</div>
                                </div>
                            </div>

                            <div class="conversation-item sla-warning" onclick="openSLAChat('conv2')">
                                <div style="display: flex; justify-content: space-between; align-items: start;">
                                    <div>
                                        <div><strong>Lead #2024002</strong> • Mike Johnson</div>
                                        <div style="font-size: 14px; color: #7f8c8d;">KL/Selangor • ALPS: 82</div>
                                    </div>
                                    <div style="text-align: right;">
                                        <div style="font-size: 12px; color: #f39c12;">⚠️ Warning</div>
                                    </div>
                                </div>
                                <div class="sla-timer">
                                    <div class="timer-negative">-2:15</div>
                                    <div style="font-size: 12px;">Response overdue</div>
                                </div>
                            </div>

                            <div class="conversation-item sla-breach" onclick="openSLAChat('conv3')">
                                <div style="display: flex; justify-content: space-between; align-items: start;">
                                    <div>
                                        <div><strong>Lead #2024003</strong> • Lisa Wong</div>
                                        <div style="font-size: 14px; color: #7f8c8d;">Petaling Jaya • ALPS: 65</div>
                                    </div>
                                    <div style="text-align: right;">
                                        <div style="font-size: 12px; color: #e74c3c;">🚨 Breach</div>
                                    </div>
                                </div>
                                <div class="sla-timer">
                                    <div class="timer-positive">+3:45</div>
                                    <div style="font-size: 12px;">SLA breached</div>
                                </div>
                            </div>

                            <div class="conversation-item" onclick="openSLAChat('conv4')">
                                <div style="display: flex; justify-content: space-between; align-items: start;">
                                    <div>
                                        <div><strong>Lead #2024004</strong> • In Queue</div>
                                        <div style="font-size: 14px; color: #7f8c8d;">JB/Penang • ALPS: 58</div>
                                    </div>
                                    <div style="text-align: right;">
                                        <div style="font-size: 12px; color: #3498db;">⏳ Waiting</div>
                                    </div>
                                </div>
                                <div class="sla-timer">
                                    <div class="timer-negative">-8:42</div>
                                    <div style="font-size: 12px;">Initial assignment</div>
                                </div>
                            </div>

                            <div style="margin-top: 30px; padding: 15px; background: #e8f4fd; border-radius: 10px;">
                                <h4>📊 SLA Statistics</h4>
                                <div style="margin-top: 10px; font-size: 14px;">
                                    <div>✅ On Time: 2/4 (50%)</div>
                                    <div>⚠️ Warning: 1/4 (25%)</div>
                                    <div>🚨 Breached: 1/4 (25%)</div>
                                </div>
                            </div>
                        </div>

                        <div class="sla-chat-area">
                            <div class="sla-chat-header">
                                <div>
                                    <h3 id="slaCurrentChat">Select a conversation</h3>
                                    <div id="slaCurrentDetails">Click on a conversation to view details</div>
                                </div>
                                <div id="slaCurrentTimer" style="background: rgba(255,255,255,0.2); padding: 10px; border-radius: 10px;">
                                    --:--
                                </div>
                            </div>

                            <div class="sla-messages" id="slaMessages">
                                <div style="text-align: center; color: #7f8c8d; margin-top: 50px;">
                                    <h3>💬 SLA Chat Monitor</h3>
                                    <p>Select a conversation from the left to view and manage the chat</p>
                                </div>
                            </div>

                            <div class="sla-input" id="slaInputArea" style="display: none;">
                                <input type="text" placeholder="Type your message..." id="slaMessageInput" onkeypress="handleSLAMessage(event)">
                                <button onclick="sendSLAMessage()">Send</button>
                                <button onclick="escalateConversation()" style="background: #e74c3c;">Escalate</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Lead Chart Modal -->
    <div id="chartModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2 id="chartTitle">Lead Score Progression</h2>
            <canvas id="leadChart" width="400" height="200"></canvas>
            <div id="chartDetails" style="margin-top: 20px;"></div>
        </div>
    </div>

    <!-- SLA Alert -->
    <div class="sla-alert" id="slaAlert">
        <h3>🚨 SLA BREACH ALERT</h3>
        <p id="slaAlertMessage">Agent has not responded within the SLA timeframe</p>
        <div style="margin: 15px 0; padding: 15px; background: #fff3cd; border-radius: 8px;">
            <strong>Conversation:</strong> <span id="alertConversation">Lead #2024003</span><br>
            <strong>Agent:</strong> <span id="alertAgent">Lisa Wong</span><br>
            <strong>Time Exceeded:</strong> <span id="alertTime">+3:45</span>
        </div>
        <div class="alert-actions">
            <button class="btn btn-primary" onclick="goToConversation()">Go to Conversation</button>
            <button class="btn btn-danger" onclick="reassignConversation()">Reassign</button>
        </div>
    </div>

    <script>
        // Global variables
        let currentPage = 'agents';
        let selectedAgent = null;
        let selectedConversation = null;
        let leadChart = null;
        let slaTimers = {};
        let realTimeInterval;

        // Chat variables for AI interaction
        let chatCurrentStep = 0;
        let chatUserResponses = {};
        let chatAlpsScore = 0;

        // Properties and areas
        const PROPERTIES = [
            "121 Residence", "7 Tree Seven", "Acacia Residence", "Ampang", "Ara Damansara", "AraTre Residence",
            "Armani SOHO", "Arte Cheras", "Astoria", "Astoria Ampang", "Austin Regency", "Bandar Sri Permaisuri",
            "Bora Residence", "Bukit Jalil", "Cheras", "D'Cosmos", "Duta Park", "Emporis Kota Damansara",
            "Epic Residence", "Fairview Residence", "HighPark Suites", "Icon City", "Kelana Jaya", "Keramat",
            "Kota Damansara", "M Adora", "M Vertica", "Majestic Maxim", "Marina Residence", "Medini Signature",
            "Meta City", "MH Platinum 2", "Mont Kiara", "One Cochrane", "Parc3", "Petaling Jaya", "Pinnacle",
            "Pixel City Central", "Platinum Splendor", "Razak City Residences", "Rica Residence", "Sapphire Paradigm",
            "Secoya Residence", "Sentul", "Seri Kembangan", "Setapak", "Sinaran", "Sinaran Residence", "Subang Jaya",
            "Sungai Besi", "Sunway Avila", "Sunway Serene", "The Andes", "The Azure", "The Azure Residences",
            "The Birch", "The OOAK", "The PARC3", "Trion KL", "Unio Residence", "Vertu Resort", "Vista Sentul",
            "Vivo Executive Apartment", "Vivo Residence", "Youth City"
        ];

        const AREAS = ["KL/Selangor", "Perak", "JB/Penang", "Negeri Sembilan", "Genting Highlands"];

        // Questions for AI chat
        const questions = [
            {
                id: 'area',
                text: 'Hi! Welcome to BeLive. I\'m here to help you find the perfect room. Let\'s start with the area you\'re interested in:',
                type: 'select',
                options: AREAS,
                weight: 15
            },
            {
                id: 'property',
                text: 'Great choice! Here are the available properties in your selected area:',
                type: 'property_select',
                weight: 10
            },
            {
                id: 'budget',
                text: 'What\'s your budget range for monthly rent?',
                type: 'input',
                placeholder: 'e.g., 800',
                weight: 25
            },
            {
                id: 'pax',
                text: 'How many people will be staying?',
                type: 'select',
                options: ['1 person', '2 people', 'More than 2'],
                weight: 10
            },
            {
                id: 'car',
                text: 'Do you have a car?',
                type: 'select',
                options: ['Yes', 'No'],
                weight: 5
            },
            {
                id: 'parking',
                text: 'Do you need a car park lot?',
                type: 'select',
                options: ['Yes', 'No'],
                weight: 5
            },
            {
                id: 'movein',
                text: 'When are you planning to move in?',
                type: 'date',
                weight: 20
            },
            {
                id: 'tenancy',
                text: 'What\'s your preferred tenancy period?',
                type: 'select',
                options: ['6 months', '12 months'],
                weight: 5
            },
            {
                id: 'gender',
                text: 'What\'s your gender?',
                type: 'select',
                options: ['Male', 'Female'],
                weight: 0
            },
            {
                id: 'unit_spec',
                text: 'What type of unit do you prefer? (You can select multiple)',
                type: 'multiple',
                options: ['Female unit', 'Male unit', 'Mixed Gender unit'],
                weight: 5
            },
            {
                id: 'workplace',
                text: 'Where is your workplace? This helps us recommend the closest property.',
                type: 'input',
                placeholder: 'e.g., KLCC, Cyberjaya',
                weight: 10
            },
            {
                id: 'nationality',
                text: 'What\'s your nationality?',
                type: 'select',
                options: ['Malaysian', 'Others'],
                weight: 0
            }
        ];

        // Initialize dashboard
        function initializeDashboard() {
            // Set up navigation
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', () => {
                    switchPage(item.dataset.page);
                });
            });

            // Initialize agent drag and drop
            initializeDragAndDrop();

            // Start real-time updates
            startRealTimeUpdates();

            // Initialize SLA timers
            initializeSLATimers();

            // Initialize chat if on chat page
            if (currentPage === 'chat') {
                initializeChat();
            }
        }

        // Page switching
        function switchPage(pageName) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });

            // Remove active from nav items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });

            // Show selected page
            document.getElementById(pageName).classList.add('active');
            document.querySelector(`[data-page="${pageName}"]`).classList.add('active');

            currentPage = pageName;

            // Update header
            updatePageHeader(pageName);

            // Initialize page-specific functionality
            if (pageName === 'chat') {
                setTimeout(() => initializeChat(), 500);
            }
        }

        function updatePageHeader(pageName) {
            const titles = {
                'agents': 'Agent Status Dashboard',
                'leads': 'Lead Management',
                'chat': 'AI Chat Interface',
                'sla': 'SLA Monitoring'
            };

            const subtitles = {
                'agents': 'Real-time agent monitoring and queue management',
                'leads': 'Lead scoring and progression tracking',
                'chat': 'AI-powered lead qualification system',
                'sla': 'Response time monitoring and escalation'
            };

            document.getElementById('pageTitle').textContent = titles[pageName];
            document.getElementById('pageSubtitle').textContent = subtitles[pageName];
        }

        // Real-time updates
        function startRealTimeUpdates() {
            realTimeInterval = setInterval(() => {
                updateLastUpdateTime();
                updateAgentStats();
                updateLeadScores();
                updateSLATimers();
            }, 1000);
        }

        function updateLastUpdateTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString();
            document.getElementById('lastUpdate').textContent = timeString;
        }

        function updateAgentStats() {
            // Simulate real-time agent capacity changes
            const agents = document.querySelectorAll('.agent-card');
            const defaultCapacities = [3, 8, 5, 0, 2]; // Default capacities for each agent
            
            agents.forEach((agent, index) => {
                const capacityFill = agent.querySelector('.capacity-fill');
                const capacityText = agent.querySelector('.capacity-bar').nextElementSibling;
                
                // Get current capacity or set default
                let capacityMatch = capacityText.textContent.match(/(\d+)\/(\d+)/);
                let currentCapacity = capacityMatch ? parseInt(capacityMatch[1]) : defaultCapacities[index];
                const maxCapacity = 10;
                
                // Random capacity fluctuation (small chance)
                if (Math.random() < 0.05) { // 5% chance of change
                    const change = Math.random() < 0.5 ? -1 : 1;
                    currentCapacity = Math.max(0, Math.min(maxCapacity, currentCapacity + change));
                }
                
                const percentage = (currentCapacity / maxCapacity) * 100;
                capacityFill.style.width = `${percentage}%`;
                capacityText.textContent = `Capacity: ${currentCapacity}/${maxCapacity} chats`;
                
                // Update capacity class
                capacityFill.className = 'capacity-fill';
                if (percentage <= 30) capacityFill.classList.add('capacity-low');
                else if (percentage <= 70) capacityFill.classList.add('capacity-medium');
                else capacityFill.classList.add('capacity-high');
            });
        }

        function updateLeadScores() {
            // Simulate real-time lead score updates
            const ongoingLeads = document.querySelectorAll('#ongoingLeads .lead-item');
            ongoingLeads.forEach(lead => {
                const scoreElement = lead.querySelector('.lead-score');
                let currentScore = parseInt(scoreElement.textContent);
                
                // Random score fluctuation for ongoing leads
                if (Math.random() < 0.05) { // 5% chance of change
                    const change = Math.floor(Math.random() * 6) - 2; // -2 to +3
                    currentScore = Math.max(0, Math.min(100, currentScore + change));
                    scoreElement.textContent = currentScore;
                    
                    // Update score class
                    scoreElement.className = 'lead-score';
                    if (currentScore >= 70) scoreElement.classList.add('score-hot');
                    else if (currentScore >= 40) scoreElement.classList.add('score-warm');
                    else scoreElement.classList.add('score-cold');
                    
                    // Update lead item class
                    lead.className = 'lead-item';
                    if (currentScore >= 70) lead.classList.add('hot');
                    else if (currentScore >= 40) lead.classList.add('warm');
                    else lead.classList.add('cold');
                }
            });
            
            // Sort leads by score (hottest first)
            sortLeadsByScore();
        }

        function sortLeadsByScore() {
            const ongoingContainer = document.getElementById('ongoingLeads');
            const leads = Array.from(ongoingContainer.children);
            
            leads.sort((a, b) => {
                const scoreA = parseInt(a.querySelector('.lead-score').textContent);
                const scoreB = parseInt(b.querySelector('.lead-score').textContent);
                return scoreB - scoreA; // Descending order
            });
            
            leads.forEach(lead => ongoingContainer.appendChild(lead));
        }

        // SLA Timer functions
        function initializeSLATimers() {
            slaTimers = {
                'conv1': { negative: 443, positive: 0, breached: false },
                'conv2': { negative: 135, positive: 0, breached: false },
                'conv3': { negative: 0, positive: 225, breached: true },
                'conv4': { negative: 522, positive: 0, breached: false }
            };
        }

        function updateSLATimers() {
            Object.keys(slaTimers).forEach(convId => {
                const timer = slaTimers[convId];
                
                if (!timer.breached) {
                    timer.negative--;
                    if (timer.negative <= 0) {
                        timer.breached = true;
                        timer.positive = Math.abs(timer.negative);
                        timer.negative = 0;
                        
                        // Trigger SLA breach alert
                        if (convId === 'conv3') {
                            triggerSLAAlert(convId);
                        }
                    }
                } else {
                    timer.positive++;
                }
                
                // Update UI
                updateSLADisplay(convId, timer);
            });
        }

        function updateSLADisplay(convId, timer) {
            const convElement = document.querySelector(`[onclick="openSLAChat('${convId}')"]`);
            if (!convElement) return;
            
            const timerElement = convElement.querySelector('.timer-negative, .timer-positive');
            
            if (!timer.breached) {
                const minutes = Math.floor(timer.negative / 60);
                const seconds = timer.negative % 60;
                timerElement.textContent = `-${minutes}:${seconds.toString().padStart(2, '0')}`;
                timerElement.className = 'timer-negative';
                
                // Update conversation item class based on time remaining
                convElement.className = 'conversation-item';
                if (timer.negative <= 120) { // Less than 2 minutes
                    convElement.classList.add('sla-warning');
                }
            } else {
                const minutes = Math.floor(timer.positive / 60);
                const seconds = timer.positive % 60;
                timerElement.textContent = `+${minutes}:${seconds.toString().padStart(2, '0')}`;
                timerElement.className = 'timer-positive';
                convElement.className = 'conversation-item sla-breach';
            }
        }

        function triggerSLAAlert(convId) {
            const alertData = {
                'conv1': { conversation: 'Lead #2024001', agent: 'Sarah Chen' },
                'conv2': { conversation: 'Lead #2024002', agent: 'Mike Johnson' },
                'conv3': { conversation: 'Lead #2024003', agent: 'Lisa Wong' },
                'conv4': { conversation: 'Lead #2024004', agent: 'In Queue' }
            };
            
            const data = alertData[convId];
            document.getElementById('alertConversation').textContent = data.conversation;
            document.getElementById('alertAgent').textContent = data.agent;
            document.getElementById('alertTime').textContent = '+0:01';
            document.getElementById('slaAlert').style.display = 'block';
        }

        // Drag and drop functionality
        function initializeDragAndDrop() {
            const queueList = document.getElementById('queueList');
            let draggedElement = null;

            queueList.addEventListener('dragstart', (e) => {
                if (e.target.classList.contains('queue-item')) {
                    draggedElement = e.target;
                    e.target.style.opacity = '0.5';
                }
            });

            queueList.addEventListener('dragend', (e) => {
                if (e.target.classList.contains('queue-item')) {
                    e.target.style.opacity = '';
                }
            });

            queueList.addEventListener('dragover', (e) => {
                e.preventDefault();
            });

            queueList.addEventListener('drop', (e) => {
                e.preventDefault();
                const targetItem = e.target.closest('.queue-item');
                
                if (draggedElement && targetItem && targetItem !== draggedElement) {
                    const rect = targetItem.getBoundingClientRect();
                    const midpoint = rect.top + rect.height / 2;
                    
                    if (e.clientY < midpoint) {
                        queueList.insertBefore(draggedElement, targetItem);
                    } else {
                        queueList.insertBefore(draggedElement, targetItem.nextSibling);
                    }
                    
                    updateQueuePositions();
                }
                draggedElement = null;
            });
        }

        function updateQueuePositions() {
            const queueItems = document.querySelectorAll('#queueList .queue-item');
            queueItems.forEach((item, index) => {
                const positionElement = item.querySelector('div:last-child');
                positionElement.textContent = `Position: ${index + 1}`;
            });
        }

        // Agent click functionality
        function goToAgentConversations(agentId) {
            switchPage('sla');
            setTimeout(() => {
                const agentConversations = {
                    'agent1': 'conv1',
                    'agent2': 'conv2', 
                    'agent3': 'conv3',
                    'agent4': 'conv4',
                    'agent5': 'conv1'
                };
                
                const convId = agentConversations[agentId];
                if (convId) {
                    openSLAChat(convId);
                }
            }, 500);
        }

        // Lead chart functionality
        function showLeadChart(leadId) {
            const leadData = getLeadData(leadId);
            document.getElementById('chartTitle').textContent = `${leadData.name} - Score Progression`;
            
            const modal = document.getElementById('chartModal');
            modal.style.display = 'block';
            
            setTimeout(() => {
                createLeadChart(leadData);
                updateChartDetails(leadData);
            }, 100);
        }

        function getLeadData(leadId) {
            const leadDataMap = {
                'lead1': {
                    name: 'Lead #2024001',
                    scores: [0, 15, 25, 40, 55, 67, 72, 78, 82, 87],
                    messages: ['Initial', 'Area', 'Property', 'Budget', 'Pax', 'Car', 'Move-in', 'Tenancy', 'Gender', 'Final'],
                    details: 'Mont Kiara • Budget: RM1200 • Move-in: 3 days'
                },
                'lead2': {
                    name: 'Lead #2024002',
                    scores: [0, 15, 25, 35, 50, 62, 68, 75, 78, 82],
                    messages: ['Initial', 'Area', 'Property', 'Budget', 'Pax', 'Car', 'Move-in', 'Tenancy', 'Gender', 'Final'],
                    details: 'KL/Selangor • Budget: RM900 • Move-in: 1 week'
                },
                'lead3': {
                    name: 'Lead #2024003',
                    scores: [0, 15, 25, 30, 40, 48, 55, 58, 62, 65],
                    messages: ['Initial', 'Area', 'Property', 'Budget', 'Pax', 'Car', 'Move-in', 'Tenancy', 'Gender', 'Final'],
                    details: 'Petaling Jaya • Budget: RM750 • Move-in: 2 weeks'
                },
                'past1': {
                    name: 'Lead #2024-100 (Converted)',
                    scores: [0, 15, 25, 45, 60, 72, 78, 83, 88, 91],
                    messages: ['Initial', 'Area', 'Property', 'Budget', 'Pax', 'Car', 'Move-in', 'Tenancy', 'Gender', 'Final'],
                    details: 'Converted Lead • Duration: 25 mins • Agent: Sarah Chen'
                },
                'past2': {
                    name: 'Lead #2024-099 (Callback)',
                    scores: [0, 15, 25, 35, 45, 52, 58, 62, 65, 67],
                    messages: ['Initial', 'Area', 'Property', 'Budget', 'Pax', 'Car', 'Move-in', 'Tenancy', 'Gender', 'Final'],
                    details: 'Callback Scheduled • Duration: 18 mins • Agent: Mike Johnson'
                }
            };
            
            return leadDataMap[leadId] || leadDataMap['lead1'];
        }

        function createLeadChart(leadData) {
            const ctx = document.getElementById('leadChart').getContext('2d');
            
            if (leadChart) {
                leadChart.destroy();
            }
            
            leadChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: leadData.messages,
                    datasets: [{
                        label: 'ALPS Score',
                        data: leadData.scores,
                        borderColor: '#3498db',
                        backgroundColor: 'rgba(52, 152, 219, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: '#3498db',
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2,
                        pointRadius: 6,
                        pointHoverRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            grid: {
                                color: 'rgba(0,0,0,0.1)'
                            },
                            ticks: {
                                callback: function(value) {
                                    return value + '';
                                }
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(0,0,0,0.1)'
                            }
                        }
                    },
                    elements: {
                        point: {
                            hoverBackgroundColor: '#e74c3c'
                        }
                    }
                }
            });
        }

        function updateChartDetails(leadData) {
            const finalScore = leadData.scores[leadData.scores.length - 1];
            let category = 'Cold Lead';
            let categoryColor = '#95a5a6';
            
            if (finalScore >= 70) {
                category = 'Hot Lead 🔥';
                categoryColor = '#e74c3c';
            } else if (finalScore >= 40) {
                category = 'Warm Lead ⭐';
                categoryColor = '#f39c12';
            }
            
            document.getElementById('chartDetails').innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 10px;">
                        <h4>Final Score</h4>
                        <div style="font-size: 24px; font-weight: bold; color: ${categoryColor};">${finalScore}/100</div>
                        <div style="color: ${categoryColor}; font-weight: bold;">${category}</div>
                    </div>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 10px;">
                        <h4>Score Range</h4>
                        <div>Min: ${Math.min(...leadData.scores)}</div>
                        <div>Max: ${Math.max(...leadData.scores)}</div>
                        <div>Growth: +${finalScore - leadData.scores[0]}</div>
                    </div>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 10px;">
                        <h4>Details</h4>
                        <div style="font-size: 14px;">${leadData.details}</div>
                    </div>
                </div>
            `;
        }

        function closeModal() {
            document.getElementById('chartModal').style.display = 'none';
            if (leadChart) {
                leadChart.destroy();
                leadChart = null;
            }
        }

        // SLA Chat functions
        function openSLAChat(convId) {
            selectedConversation = convId;
            
            const conversations = {
                'conv1': {
                    title: 'Lead #2024001 - Sarah Chen',
                    details: 'Mont Kiara • ALPS: 87 • Active for 12 mins',
                    messages: [
                        { type: 'customer', text: 'Hi, I\'m looking for a room in Mont Kiara area', time: '14:32' },
                        { type: 'agent', text: 'Hello! I\'d be happy to help you find a perfect room in Mont Kiara. What\'s your budget range?', time: '14:33' },
                        { type: 'customer', text: 'Around RM1200 per month. I need to move in within 3 days', time: '14:34' },
                        { type: 'agent', text: 'Great! I have several excellent options for you. Let me show you our available units...', time: '14:35' },
                        { type: 'customer', text: 'That sounds perfect! Can you tell me more about the amenities?', time: '14:42' }
                    ]
                },
                'conv2': {
                    title: 'Lead #2024002 - Mike Johnson',
                    details: 'KL/Selangor • ALPS: 82 • ⚠️ Response overdue',
                    messages: [
                        { type: 'customer', text: 'Hello, I saw your listing for rooms in KL', time: '14:45' },
                        { type: 'agent', text: 'Hi there! Thanks for your interest. Which area in KL are you looking at?', time: '14:46' },
                        { type: 'customer', text: 'Preferably somewhere near public transport. Budget around RM900', time: '14:47' },
                        { type: 'customer', text: 'Are you still there? I\'m quite interested', time: '14:50' },
                        { type: 'customer', text: 'Hello?? I need to find a place soon', time: '14:52' }
                    ]
                },
                'conv3': {
                    title: 'Lead #2024003 - Lisa Wong',
                    details: 'Petaling Jaya • ALPS: 65 • 🚨 SLA Breached',
                    messages: [
                        { type: 'customer', text: 'Hi, I\'m looking for accommodation in PJ', time: '14:52' },
                        { type: 'agent', text: 'Hello! I can help you with that. What type of accommodation are you looking for?', time: '14:53' },
                        { type: 'customer', text: 'A single room, budget around RM750. When can I view?', time: '14:54' },
                        { type: 'customer', text: 'Can someone please respond? I have other options to consider', time: '14:58' },
                        { type: 'customer', text: 'This is taking too long. I might go with another agent', time: '15:01' }
                    ]
                }
            };
            
            const conv = conversations[convId];
            if (!conv) return;
            
            // Update SLA chat header
            document.getElementById('slaCurrentChat').textContent = conv.title;
            document.getElementById('slaCurrentDetails').textContent = conv.details;
            
            // Update timer display
            const timer = slaTimers[convId];
            if (timer) {
                const timerElement = document.getElementById('slaCurrentTimer');
                if (!timer.breached) {
                    const minutes = Math.floor(timer.negative / 60);
                    const seconds = timer.negative % 60;
                    timerElement.textContent = `-${minutes}:${seconds.toString().padStart(2, '0')}`;
                    timerElement.style.background = 'rgba(46, 204, 113, 0.2)';
                } else {
                    const minutes = Math.floor(timer.positive / 60);
                    const seconds = timer.positive % 60;
                    timerElement.textContent = `+${minutes}:${seconds.toString().padStart(2, '0')}`;
                    timerElement.style.background = 'rgba(231, 76, 60, 0.2)';
                }
            }
            
            // Load messages
            const messagesContainer = document.getElementById('slaMessages');
            messagesContainer.innerHTML = '';
            
            conv.messages.forEach(msg => {
                const messageDiv = document.createElement('div');
                messageDiv.className = `message message-${msg.type === 'customer' ? 'user' : 'bot'}`;
                messageDiv.innerHTML = `
                    <div>${msg.text}</div>
                    <div style="font-size: 12px; color: #7f8c8d; margin-top: 5px;">${msg.time}</div>
                `;
                messagesContainer.appendChild(messageDiv);
            });
            
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
            
            // Show input area
            document.getElementById('slaInputArea').style.display = 'flex';
        }

        function handleSLAMessage(event) {
            if (event.key === 'Enter') {
                sendSLAMessage();
            }
        }

        function sendSLAMessage() {
            const input = document.getElementById('slaMessageInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Add message to chat
            const messagesContainer = document.getElementById('slaMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message message-bot';
            messageDiv.innerHTML = `
                <div>${message}</div>
                <div style="font-size: 12px; color: #7f8c8d; margin-top: 5px;">${new Date().toLocaleTimeString()}</div>
            `;
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
            
            // Clear input
            input.value = '';
            
            // Reset SLA timer for this conversation
            if (selectedConversation && slaTimers[selectedConversation]) {
                slaTimers[selectedConversation].negative = 1200; // Reset to 20 minutes
                slaTimers[selectedConversation].positive = 0;
                slaTimers[selectedConversation].breached = false;
            }
            
            // Simulate customer response after a delay
            setTimeout(() => {
                const responseDiv = document.createElement('div');
                responseDiv.className = 'message message-user';
                responseDiv.innerHTML = `
                    <div>Thank you for your response! That's very helpful.</div>
                    <div style="font-size: 12px; color: #7f8c8d; margin-top: 5px;">${new Date().toLocaleTimeString()}</div>
                `;
                messagesContainer.appendChild(responseDiv);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }, 3000);
        }

        function escalateConversation() {
            if (!selectedConversation) return;
            
            const messagesContainer = document.getElementById('slaMessages');
            const escalationDiv = document.createElement('div');
            escalationDiv.className = 'message';
            escalationDiv.style.background = '#fff3cd';
            escalationDiv.style.border = '2px solid #ffeaa7';
            escalationDiv.innerHTML = `
                <div><strong>🔄 Conversation Escalated</strong></div>
                <div>This conversation has been escalated to a supervisor and will be reassigned.</div>
                <div style="font-size: 12px; color: #7f8c8d; margin-top: 5px;">${new Date().toLocaleTimeString()}</div>
            `;
            messagesContainer.appendChild(escalationDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
            
            // Update conversation status
            setTimeout(() => {
                alert('Conversation escalated successfully. Supervisor will take over within 2 minutes.');
            }, 1000);
        }

        // SLA Alert functions
        function goToConversation() {
            document.getElementById('slaAlert').style.display = 'none';
            switchPage('sla');
            setTimeout(() => {
                openSLAChat('conv3');
            }, 500);
        }

        function reassignConversation() {
            document.getElementById('slaAlert').style.display = 'none';
            alert('Conversation has been reassigned to the next available agent.');
            
            // Reset timer
            slaTimers['conv3'] = { negative: 600, positive: 0, breached: false };
        }

        // Agent management functions
        function promoteToTopSales() {
            alert('Selected agent has been promoted to Top Sales position.');
        }

        function removeFromQueue() {
            alert('Selected agent has been removed from the queue.');
        }

        // Chat AI functions
        function initializeChat() {
            chatCurrentStep = 0;
            chatUserResponses = {};
            chatAlpsScore = 0;
            
            const messagesContainer = document.getElementById('chatMessages');
            messagesContainer.innerHTML = '<div class="typing-indicator" id="typingIndicator"><div class="typing-dots"><div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div></div></div>';
            
            setTimeout(() => {
                askQuestion(0);
            }, 1000);
        }

        function askQuestion(stepIndex) {
            if (stepIndex >= questions.length) {
                finalizeLead();
                return;
            }

            const question = questions[stepIndex];
            chatCurrentStep = stepIndex;

            showTyping();
            
            setTimeout(() => {
                hideTyping();
                
                let messageContent = `<div>${question.text}</div>`;
                
                if (question.type === 'select') {
                    messageContent += `<div class="options-container">`;
                    question.options.forEach((option, index) => {
                        messageContent += `<div class="option-button" onclick="selectOption('${question.id}', '${option}')">${option}</div>`;
                    });
                    messageContent += `</div>`;
                } else if (question.type === 'property_select') {
                    const filteredProperties = getPropertiesForArea(chatUserResponses.area || 'KL/Selangor');
                    messageContent += `<div class="property-grid">`;
                    filteredProperties.forEach(property => {
                        messageContent += `<div class="property-item" onclick="selectOption('${question.id}', '${property}')">${property}</div>`;
                    });
                    messageContent += `</div>`;
                } else if (question.type === 'input') {
                    messageContent += `<input type="text" class="input-field" placeholder="${question.placeholder}" onkeypress="handleInputKeypress(event, '${question.id}')">`;
                } else if (question.type === 'date') {
                    messageContent += `<input type="date" class="input-field" onchange="handleDateChange(event, '${question.id}')">`;
                } else if (question.type === 'multiple') {
                    messageContent += createMultipleChoiceOptions(question.id, question.options);
                }
                
                addMessage(messageContent, 'bot');
            }, 1500);
        }

        function createMultipleChoiceOptions(questionId, options) {
            let content = '<div class="checkbox-group">';
            options.forEach((option, index) => {
                const optionId = `${questionId}_${index}`;
                content += `
                    <div class="checkbox-item" onclick="toggleCheckbox('${optionId}')">
                        <input type="checkbox" id="${optionId}" value="${option}">
                        <label for="${optionId}">${option}</label>
                    </div>`;
            });
            content += `<button class="btn btn-primary" onclick="submitMultipleChoice('${questionId}')" style="margin-top: 15px; padding: 10px 20px; background: #25D366; color: white; border: none; border-radius: 8px; cursor: pointer;">Continue</button>`;
            content += '</div>';
            return content;
        }

        function toggleCheckbox(checkboxId) {
            const checkbox = document.getElementById(checkboxId);
            checkbox.checked = !checkbox.checked;
        }

        function submitMultipleChoice(questionId) {
            const checkboxes = document.querySelectorAll(`input[id^="${questionId}_"]:checked`);
            const values = Array.from(checkboxes).map(cb => cb.value);
            
            if (values.length > 0) {
                chatUserResponses[questionId] = values;
                addMessage(values.join(', '), 'user');
                
                const question = questions.find(q => q.id === questionId);
                calculateAlpsScore(questionId, values, question.weight);
                
                setTimeout(() => askQuestion(chatCurrentStep + 1), 1000);
            } else {
                alert('Please select at least one option');
            }
        }

        function addMessage(text, sender) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message message-${sender}`;
            messageDiv.innerHTML = text;
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function showTyping() {
            document.getElementById('typingIndicator').style.display = 'block';
            document.getElementById('chatMessages').scrollTop = document.getElementById('chatMessages').scrollHeight;
        }

        function hideTyping() {
            document.getElementById('typingIndicator').style.display = 'none';
        }

        function selectOption(questionId, value) {
            chatUserResponses[questionId] = value;
            addMessage(value, 'user');
            
            // Calculate score increment using your pickle model
            const question = questions.find(q => q.id === questionId);
            calculateAlpsScore(questionId, value, question.weight);
            
            setTimeout(() => askQuestion(chatCurrentStep + 1), 1000);
        }

        function handleInputKeypress(event, questionId) {
            if (event.key === 'Enter') {
                const value = event.target.value.trim();
                if (value) {
                    selectOption(questionId, value);
                }
            }
        }

        function handleDateChange(event, questionId) {
            const value = event.target.value;
            if (value) {
                selectOption(questionId, value);
            }
        }

        function calculateAlpsScore(questionId, value, weight) {
            // This is where you would integrate your pickle model
            // For now, using the existing scoring logic
            let scoreIncrement = 0;
            
            switch (questionId) {
                case 'area':
                    scoreIncrement = weight;
                    break;
                case 'property':
                    scoreIncrement = weight;
                    break;
                case 'budget':
                    const budget = parseInt(value);
                    if (budget >= 800) scoreIncrement = weight;
                    else if (budget >= 600) scoreIncrement = weight * 0.7;
                    else if (budget >= 400) scoreIncrement = weight * 0.4;
                    else scoreIncrement = weight * 0.1;
                    break;
                case 'movein':
                    const moveDate = new Date(value);
                    const today = new Date();
                    const daysDiff = Math.ceil((moveDate - today) / (1000 * 60 * 60 * 24));
                    if (daysDiff <= 7) scoreIncrement = weight;
                    else if (daysDiff <= 30) scoreIncrement = weight * 0.8;
                    else if (daysDiff <= 60) scoreIncrement = weight * 0.6;
                    else scoreIncrement = weight * 0.3;
                    break;
                default:
                    scoreIncrement = weight * 0.8;
            }
            
            chatAlpsScore += scoreIncrement;
            updateChatScoreDisplay();
        }

        function updateChatScoreDisplay() {
            const scoreElement = document.getElementById('chatScoreBar');
            const scoreText = document.getElementById('chatScoreText');
            const scoreCategory = document.getElementById('chatScoreCategory');
            
            const percentage = Math.min(chatAlpsScore, 100);
            scoreElement.style.width = `${percentage}%`;
            scoreText.textContent = `${Math.round(chatAlpsScore)} / 100`;
            
            if (chatAlpsScore >= 70) {
                scoreCategory.textContent = 'Hot Lead 🔥';
            } else if (chatAlpsScore >= 40) {
                scoreCategory.textContent = 'Warm Lead ⭐';
            } else {
                scoreCategory.textContent = 'Cold Lead ❄️';
            }
        }

        function getPropertiesForArea(area) {
            return PROPERTIES.slice(0, 12);
        }

        function finalizeLead() {
            showTyping();
            setTimeout(() => {
                hideTyping();
                
                if (chatAlpsScore >= 60) {
                    const routeMessage = `
                        <div style="background: #e8f5e8; padding: 15px; border-radius: 12px; border-left: 4px solid #2ecc71;">
                            <h3>🎉 High Priority Lead Detected!</h3>
                            <p><strong>Your ALPS Score: ${Math.round(chatAlpsScore)}/100</strong></p>
                            <p>This lead will be routed to our top sales agent for immediate attention.</p>
                            <p>🔄 Routing to agent now...</p>
                        </div>
                    `;
                    addMessage(routeMessage, 'bot');
                } else {
                    const continueMessage = `
                        <div style="background: #fff8e1; padding: 15px; border-radius: 12px; border-left: 4px solid #f39c12;">
                            <h3>📋 Lead Information Collected</h3>
                            <p><strong>ALPS Score: ${Math.round(chatAlpsScore)}/100</strong></p>
                            <p>Thank you for providing your information. Our AI will continue to assist you.</p>
                        </div>
                    `;
                    addMessage(continueMessage, 'bot');
                }
            }, 2000);
        }

        // Initialize dashboard when page loads
        window.onload = function() {
            initializeDashboard();
            
            // Close modal when clicking outside
            window.onclick = function(event) {
                const modal = document.getElementById('chartModal');
                if (event.target === modal) {
                    closeModal();
                }
            };
        };
    </script>
</body>
</html>
